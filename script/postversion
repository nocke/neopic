#!/usr/bin/env node
import {exec} from './script-helpers.js'

try {
  const branch = exec(`git rev-parse --abbrev-ref HEAD`).trim()
  const remoteRepo = exec(`git config branch.${branch}.remote`).trim()
  const remoteBranch = exec(`git rev-parse --abbrev-ref --symbolic-full-name ${branch}@{u}`).split('/')[1].trim()
  const tag = exec('git for-each-ref refs/tags/ --count=1 --sort=-creatordate --format="%(refname:short)"').trim()

  exec(`git push ${remoteRepo} ${branch}:${remoteBranch}`)
  exec(`git push ${remoteRepo} ${tag}`)

  console.log(`will push ${branch} to ${remoteBranch} on ${remoteRepo} and tag ${tag}`)
} catch (error) {
  console.error('failed to push changes:', error)
  process.exit(1)
}
